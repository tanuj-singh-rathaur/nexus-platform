# ==========================================================
# 1. CORE APPLICATION SETUP
# ==========================================================
# Unique name for the portfolio service
spring.application.name=portfolio-service

# Running on port 8081 to avoid conflicts with Identity (9898) and Gateway (8080)
server.port=8081

# ==========================================================
# 2. DATABASE CONFIGURATION (PostgreSQL)
# ==========================================================
# DB_NAME defaults to nexus_portfolio as per your Docker init script
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:5432/${DB_NAME:nexus_portfolio}
spring.datasource.username=${DB_USER:nexus}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate settings for schema management
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==========================================================
# 3. SERVICE DISCOVERY (Netflix Eureka)
# ==========================================================
# Internal hostname for Docker networking (mapped to container name)
eureka.instance.hostname=${SPRING_APPLICATION_NAME:localhost}

# Set to 'false' so the Gateway routes via the container name 'portfolio-service'
eureka.instance.prefer-ip-address=false

# Unique Instance ID format
eureka.instance.instance-id=${spring.application.name}:${eureka.instance.hostname}:${server.port}

# Connection to the central Eureka server
eureka.client.service-url.defaultZone=${EUREKA_URI:http://service-registry:8761/eureka/}

# ==========================================================
# 4. OBSERVABILITY: TRACING & MONITORING (Micrometer)
# ==========================================================
# Capture 100% of traces for debugging nexus-platform interactions
management.tracing.sampling.probability=1.0

# Zipkin Endpoint for distributed tracing
management.tracing.export.zipkin.endpoint=${ZIPKIN_URL:http://zipkin:9411/api/v2/spans}

# Expose Actuator endpoints for Healthchecks and Prometheus metrics
management.endpoints.web.exposure.include=health,info,prometheus,metrics

# ==========================================================
# 5. DOCUMENTATION (SpringDoc/Swagger)
# ==========================================================
# Enable forward-header strategy for Swagger stability behind the Gateway
server.forward-headers-strategy=framework

# API Documentation paths
springdoc.api-docs.path=/v3/api-docs
springdoc.writer-with-default-pretty-printer=true
springdoc.swagger-ui.config-url=/v3/api-docs/swagger-config

# ==========================================================
# 6. LOGGING PATTERN
# ==========================================================
# Correlation fields: traceId and spanId (Required for Grafana/Loki linking)
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]