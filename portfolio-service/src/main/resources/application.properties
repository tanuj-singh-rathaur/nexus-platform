# ==========================================================
# 1. CORE SERVER SETUP
# ==========================================================
server.port=8081
spring.application.name=portfolio-service

# ==========================================================
# 2. DATABASE CONFIGURATION (PostgreSQL)
# ==========================================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:5432/${DB_NAME:nexus_portfolio}
spring.datasource.username=${DB_USER:nexus}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=org.postgresql.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==========================================================
# 3. SERVICE DISCOVERY (Eureka)
# ==========================================================
eureka.instance.hostname=${SPRING_APPLICATION_NAME:localhost}
eureka.instance.prefer-ip-address=false
eureka.instance.instance-id=${spring.application.name}:${eureka.instance.hostname}:${server.port}

# Directs to Docker service-registry, with localhost fallback
eureka.client.service-url.defaultZone=${EUREKA_URI:http://service-registry:8761/eureka/}

# ==========================================================
# 4. RABBITMQ CONFIGURATION (Hybrid)
# ==========================================================
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:guest}
spring.rabbitmq.connection-name-strategy=${spring.application.name}
spring.rabbitmq.connection-name=${spring.application.name}
spring.rabbitmq.template.retry.enabled=true
spring.rabbitmq.template.retry.initial-interval=2s
spring.rabbitmq.template.retry.max-attempts=3

# ==========================================================
# 5. OBSERVABILITY & DOCUMENTATION
# ==========================================================
management.tracing.sampling.probability=1.0
management.tracing.export.zipkin.endpoint=${ZIPKIN_URL:http://zipkin:9411/api/v2/spans}
management.endpoints.web.exposure.include=health,info,prometheus,metrics

server.forward-headers-strategy=framework
springdoc.api-docs.path=/v3/api-docs
springdoc.writer-with-default-pretty-printer=true
springdoc.swagger-ui.config-url=/v3/api-docs/swagger-config
# Tells Micrometer to look for B3 (Zipkin) headers in incoming MQ messages
management.tracing.propagation.type=b3

# ==========================================================
# 6. LOGGING PATTERN (Loki/Grafana Ready)
# ==========================================================
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]