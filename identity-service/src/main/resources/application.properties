# ==========================================================
# 1. CORE APPLICATION SETUP
# ==========================================================
# Unique name for the service (used for discovery and logging)
spring.application.name=identity-service

# Port on which the service will run (overridden by Docker)
server.port=9898

# ==========================================================
# 2. DATABASE CONFIGURATION (PostgreSQL)
# ==========================================================
# JDBC URL: Uses environment variables with 'localhost' as fallback for local IDE runs
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:5432/${DB_NAME:nexus_users}
spring.datasource.username=${DB_USER:nexus}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate settings for schema management and debugging
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# ==========================================================
# 3. SERVICE DISCOVERY (Netflix Eureka)
# ==========================================================
# Internal hostname for Docker networking (should match SPRING_APPLICATION_NAME)
eureka.instance.hostname=${SPRING_APPLICATION_NAME:localhost}

# Set to 'false' so Eureka uses the hostname/container name for routing instead of IP
eureka.instance.prefer-ip-address=false

# Unique Instance ID format: ServiceName : Hostname : Port
eureka.instance.instance-id=${spring.application.name}:${eureka.instance.hostname}:${server.port}

# Eureka Server registration URL (Registry container name is 'service-registry')
eureka.client.service-url.defaultZone=${EUREKA_URI:http://service-registry:8761/eureka/}

# ==========================================================
# 4. OBSERVABILITY: TRACING & MONITORING (Micrometer)
# ==========================================================
# Sampling Probability: 1.0 means capture 100% of requests (use lower for production)
management.tracing.sampling.probability=1.0

# Zipkin Endpoint for distributed tracing
management.tracing.export.zipkin.endpoint=${ZIPKIN_URL:http://zipkin:9411/api/v2/spans}

# Standard name for tracing observation
management.observations.http.server.requests.name=http.server.requests

# ==========================================================
# 5. ACTUATOR & DOCUMENTATION (SpringDoc/Swagger)
# ==========================================================
# Expose management endpoints for Grafana, Prometheus, and Healthchecks
management.endpoints.web.exposure.include=health,info,prometheus,metrics

# Enable forward-header strategy so Swagger works behind the API Gateway
server.forward-headers-strategy=framework

# API Documentation path settings
springdoc.api-docs.path=/v3/api-docs
springdoc.writer-with-default-pretty-printer=true
springdoc.swagger-ui.config-url=/v3/api-docs/swagger-config

# ==========================================================
# 6. LOGGING PATTERN
# ==========================================================

# 2. Enable Spring Security's internal logs (shows the filter chain)
logging.level.org.springframework.security=DEBUG

# 3. Optional: Extremely detailed trace logs
# logging.level.org.springframework.security=TRACE

# Standard pattern including Application Name, TraceId, and SpanId
logging.pattern.level=%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]
# ==========================================================
# 4. RABBITMQ CONFIGURATION (Hybrid)
# ==========================================================
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:localhost}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:guest}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:guest}
spring.rabbitmq.connection-name-strategy=${spring.application.name}
spring.rabbitmq.connection-name=${spring.application.name}
spring.rabbitmq.template.retry.enabled=true
spring.rabbitmq.template.retry.initial-interval=2s
spring.rabbitmq.template.retry.max-attempts=3
spring.rabbitmq.listener.simple.observation-enabled=true
spring.rabbitmq.template.observation-enabled=true
